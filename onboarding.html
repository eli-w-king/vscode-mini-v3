<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VS Code Onboarding Concept</title>

  <style>
    :root{
      /* VS Code-ish typography */
      --font: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, Roboto, Helvetica, Arial, sans-serif;
      --fs: 13px;
      --lh: 1.4;
  
      /* VS Code-ish spacing scale */
      --s1: 4px;
      --s2: 8px;
      --s3: 12px;
      --s4: 16px;
      --s5: 20px;
  
      /* Colors (still your concept, but flatter like workbench) */
      --bg0:#0f111a;
      --bg1:#0f1420;
      --panel: rgba(255,255,255,.03);
      --panel2: rgba(255,255,255,.02);
      --card: rgba(255,255,255,.035);
  
      --text:#d4d4d4;     /* VS Code default-ish */
      --muted:#9da3ad;
  
      --line: rgba(255,255,255,.10);
      --line2: rgba(255,255,255,.07);
  
      --accent:#3794ff;   /* VS Code blue */
      --accentSoft: rgba(55,148,255,.22);
  
      /* Smaller radii like VS Code */
      --r0: 4px;
      --r1: 6px;
  
      /* Flatter elevation */
      --shadow: 0 8px 24px rgba(0,0,0,.35);
      --shadow2: 0 2px 10px rgba(0,0,0,.22);
  
      font-family: var(--font);
      font-size: var(--fs);
      line-height: var(--lh);
    }
  
    *{box-sizing:border-box}
    body{
      margin:0;
      color:var(--text);
      background:
        radial-gradient(900px 420px at 50% 20%, rgba(55,148,255,.10), transparent 60%),
        linear-gradient(180deg,var(--bg0),var(--bg1));
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: var(--s4);
    }
  
    /* Animated background canvas (WebGL) */
    #bg{
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none; /* never block onboarding UI */
    }

    .app{
      width:min(980px, 100%);
      border:1px solid var(--line2);
      background: rgba(15,17,26,.72);
      backdrop-filter: blur(8px);
      border-radius: var(--r1);
      box-shadow: var(--shadow);
      overflow:hidden;
      position: relative;
      z-index: 1; /* above canvas */
    }
  
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: var(--s3) var(--s4);
      border-bottom:1px solid var(--line2);
    }
  
    .brand{display:flex; align-items:center; gap: var(--s3);}
    .logo{
      width: 34px;
      height: 34px;
      display:block;
      border: 0;
      background: transparent;
      padding: 0;
      border-radius: 0;
      object-fit: contain;
    }
  
    h1{
      font-size: 13px;
      font-weight: 600;
      margin:0;
      letter-spacing: 0;
    }
    .sub{
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }
  
    /* Workbench-ish pill: flatter + smaller */
    .pill{
      display:inline-flex;
      align-items:center;
      gap: var(--s2);
      padding: 6px 10px;
      font-size: 12px;
      color: var(--text);
      border:1px solid var(--line2);
      background: var(--panel2);
      border-radius: var(--r0);
      cursor:pointer;
      user-select:none;
      transition: border-color .12s ease, background .12s ease;
    }
    .pill:hover{
      border-color: rgba(55,148,255,.35);
      background: rgba(55,148,255,.10);
    }
  
    main{padding: var(--s4);}
  
    .screen{display:none}
    .screen.active{display:block}
  
    .title{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: var(--s4);
      margin-bottom: var(--s3);
    }
    .title h2{
      margin:0;
      font-size: 18px;      /* smaller than before */
      font-weight: 600;
      letter-spacing: 0;
    }
    .title p{
      margin: var(--s1) 0 0;
      color: var(--muted);
      font-size: 12px;
    }
  
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: var(--s3);
    }
  
    .section{
      grid-column: span 12;
      border:1px solid var(--line2);
      border-radius: var(--r1);
      background: var(--panel);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .section .hd{
      padding: var(--s2) var(--s3);
      border-bottom:1px solid var(--line2);
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap: var(--s2);
    }
    .section .hd .k{font-size:12px; font-weight:600;}
    .section .hd .hint{font-size:12px; color:var(--muted);}
    .section .bd{padding: var(--s3);}
  
    /* Cards: smaller radius + flatter */
    .cards{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--s2);
    }
    @media (max-width: 820px){ .cards{grid-template-columns:1fr} }
  
    .card{
      border:1px solid var(--line2);
      border-radius: var(--r1);
      background: var(--card);
      padding: var(--s3);
      cursor:pointer;
      user-select:none;
      transition: border-color .12s ease, background .12s ease;
      position:relative;
      overflow:hidden;
    }
    .card:hover{
      border-color: rgba(55,148,255,.30);
      background: rgba(55,148,255,.08);
    }
    .card.selected{
      border-color: rgba(55,148,255,.55);
      box-shadow: 0 0 0 2px rgba(55,148,255,.18) inset;
    }
    .card .nm{font-size:13px; font-weight:600}
    .card .ds{margin-top: var(--s1); font-size:12px; color:var(--muted)}
  
    .preview{
      margin-top: var(--s2);
      border-radius: var(--r0);
      border:1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.18);
      padding: var(--s2);
      height: 84px; /* tighter */
    }
    .line{
      height: 6px;
      border-radius: 6px;
      margin: 6px 0;
      opacity:.95;
      background: linear-gradient(90deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      width: 92%;
    }
    .line.s{width:70%}
    .line.xs{width:48%}
    .theme-vivid .line:nth-child(1){background:linear-gradient(90deg, rgba(55,148,255,.55), rgba(255,255,255,.05))}
    .theme-vivid .line:nth-child(3){background:linear-gradient(90deg, rgba(255,210,102,.45), rgba(255,255,255,.05))}
    .theme-warm .line:nth-child(1){background:linear-gradient(90deg, rgba(255,160,120,.50), rgba(255,255,255,.05))}
    .theme-warm .line:nth-child(3){background:linear-gradient(90deg, rgba(255,210,102,.35), rgba(255,255,255,.05))}
  
    /* Segmented buttons: compact */
    .seg{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--s2);
    }
    @media (max-width:820px){ .seg{grid-template-columns:1fr} }
  
    .segbtn{
      padding: 8px 10px;
      border-radius: var(--r1);
      border:1px solid var(--line2);
      background: var(--panel2);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      transition: border-color .12s ease, background .12s ease;
      font-size:12.5px;
    }
    .segbtn:hover{
      border-color: rgba(55,148,255,.30);
      background: rgba(55,148,255,.08);
    }
    .segbtn.selected{
      border-color: rgba(55,148,255,.55);
      box-shadow: 0 0 0 2px rgba(55,148,255,.18) inset;
    }
    .segbtn .mini{font-size:12px; color:var(--muted)}
  
    /* Toggle rows */
    .tog{
      display:flex; align-items:center; justify-content:space-between;
      padding: 8px 10px;
      border:1px solid var(--line2);
      border-radius: var(--r1);
      background: var(--panel2);
      margin-top: var(--s2);
    }
    .tog .l{display:flex; flex-direction:column; gap:2px}
    .tog .l b{font-size:12.5px; font-weight:600}
    .tog .l span{font-size:12px; color:var(--muted)}
  
    /* Switch: smaller */
    .switch{
      width:40px; height:22px; border-radius:999px;
      border:1px solid var(--line2);
      background: rgba(255,255,255,.05);
      position:relative;
      cursor:pointer;
      transition: background .12s ease, border-color .12s ease;
    }
    .switch:after{
      content:"";
      width:16px; height:16px;
      border-radius:999px;
      background: rgba(255,255,255,.78);
      position:absolute; top:2px; left:2px;
      transition: transform .12s ease;
    }
    .switch.on{
      background: rgba(55,148,255,.22);
      border-color: rgba(55,148,255,.40);
    }
    .switch.on:after{transform: translateX(18px)}
  
    /* Buttons: more workbench */
    .actions{
      display:flex;
      justify-content:flex-end;
      gap: var(--s2);
      margin-top: var(--s3);
    }
    .btn{
      padding: 7px 12px;
      border-radius: var(--r0);
      border:1px solid var(--line2);
      background: var(--panel2);
      color:var(--text);
      cursor:pointer;
      font-size:12.5px;
      transition: border-color .12s ease, background .12s ease;
    }
    .btn:hover{
      border-color: rgba(55,148,255,.30);
      background: rgba(55,148,255,.08);
    }
    .btn.primary{
      background: rgba(55,148,255,.18);
      border-color: rgba(55,148,255,.50);
    }
  
    /* Screen 2: choice cards flatter + tighter */
    .choices{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--s2);
    }
    @media (max-width:820px){ .choices{grid-template-columns:1fr} }
  
    .choice{
      padding: var(--s4);
      border-radius: var(--r1);
      border:1px solid var(--line2);
      background: var(--card);
      cursor:pointer;
      transition: border-color .12s ease, background .12s ease;
      min-height: 148px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .choice:hover{
      border-color: rgba(55,148,255,.30);
      background: rgba(55,148,255,.08);
    }
    .choice h3{margin:0; font-size:14px; font-weight:600}
    .choice p{margin: var(--s1) 0 0; color:var(--muted); font-size:12px; max-width:48ch}
    .choice .row{display:flex; justify-content:space-between; align-items:center; gap: var(--s2)}
  
    .blink{
      width:8px; height:16px; border-radius:2px;
      background: rgba(255,255,255,.70);
      animation: blink 1.2s steps(2,end) infinite;
      opacity:.9;
    }
    @keyframes blink{50%{opacity:.15}}
  
    .micro{margin-top: var(--s3); font-size:12px; color:var(--muted)}

    @media (prefers-reduced-motion: reduce){
      #bg{display:none}
    }
  </style>
</head>

<body>
  <canvas id="bg" aria-hidden="true"></canvas>
  <div class="app" id="app">
    <header>
      <div class="brand">
        <img class="logo" src="assets/visual-studio-code-icons/vscode.svg" alt="VS Code" />
        <div>
          <h1>Welcome to VS Code</h1>
          <div class="sub">The editor that adapts to how you think.</div>
        </div>
      </div>
      <div class="pill" id="pillAction" title="Continue">
        Finish Setup <span style="opacity:.7">⌘↩</span>
      </div>
    </header>

    <main>
      <!-- Screen 1 -->
      <section class="screen active" id="screen-setup" aria-label="Setup">
        <div class="title">
          <div>
            <h2>Make VS Code yours.</h2>
            <p>Pick a starting look and a familiar keymap. Everything is changeable later.</p>
          </div>
        </div>

        <div class="grid">
          <div class="section">
            <div class="hd">
              <div class="k">Theme</div>
              <div class="hint">Choose a starting feel</div>
            </div>
            <div class="bd">
              <div class="cards" id="themeCards">
                <div class="card theme-minimal" data-theme="minimal">
                  <div class="nm">Minimal</div>
                  <div class="ds">Calm contrast. Fewer accents.</div>
                  <div class="preview">
                    <div class="line"></div><div class="line s"></div><div class="line xs"></div><div class="line s"></div>
                  </div>
                </div>
                <div class="card theme-vivid" data-theme="vivid">
                  <div class="nm">Vivid</div>
                  <div class="ds">Strong syntax. Faster scanning.</div>
                  <div class="preview">
                    <div class="line"></div><div class="line s"></div><div class="line xs"></div><div class="line s"></div>
                  </div>
                </div>
                <div class="card theme-warm" data-theme="warm">
                  <div class="nm">Warm</div>
                  <div class="ds">Soft tones. Long-session friendly.</div>
                  <div class="preview">
                    <div class="line"></div><div class="line s"></div><div class="line xs"></div><div class="line s"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="section">
            <div class="hd">
              <div class="k">Base keymap</div>
              <div class="hint">Match your muscle memory</div>
            </div>
            <div class="bd">
              <div class="seg" id="keymapSeg">
                <div class="segbtn" data-keymap="vscode"><span>VS Code</span><span class="mini">default</span></div>
                <div class="segbtn" data-keymap="jetbrains"><span>JetBrains</span><span class="mini">IDE-style</span></div>
                <div class="segbtn" data-keymap="vim"><span>Vim</span><span class="mini">modal</span></div>
                <div class="segbtn" data-keymap="cursor"><span>Cursor</span><span class="mini">AI-first</span></div>
                <div class="segbtn" data-keymap="sublime"><span>Sublime</span><span class="mini">classic</span></div>
              </div>

              <div class="tog">
                <div class="l">
                  <b>Vim mode</b>
                  <span>Enable a first-class modal workflow.</span>
                </div>
                <div class="switch" id="swVim" role="switch" aria-checked="false"></div>
              </div>

              <div class="tog">
                <div class="l">
                  <b>Sync settings</b>
                  <span>Carry this setup across devices.</span>
                </div>
                <div class="switch" id="swSync" role="switch" aria-checked="false"></div>
              </div>

              <div class="actions">
                <button class="btn primary" id="btnContinue">Continue →</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Screen 2 -->
      <section class="screen" id="screen-start" aria-label="Start">
        <div class="title">
          <div>
            <h2>You’re ready.</h2>
            <p>Choose your path. You can always return to setup later.</p>
          </div>
        </div>

        <div class="choices">
          <div class="choice" id="choiceBack">
            <div>
              <h3>Refine my setup</h3>
              <p>Extensions, layout, shortcuts, and the small details that add up.</p>
            </div>
            <div class="row">
              <button class="btn" id="btnBack">Back to Setup</button>
              <div style="opacity:.65;font-size:12px">Panels snap into place</div>
            </div>
          </div>

          <div class="choice" id="choiceStart">
            <div>
              <h3>Start coding</h3>
              <p>Open a folder, clone a repo, or begin from a clean slate.</p>
            </div>
            <div class="row">
              <button class="btn primary" id="btnGetStarted">Get Started</button>
              <div class="blink" aria-hidden="true"></div>
            </div>
          </div>
        </div>

        <div class="micro">
          Tip: Press <b>⌘P</b> anytime to jump to files, commands, and actions.
        </div>
      </section>
    </main>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    const state = {
      step: "setup",
      themePreset: "vivid",
      keymap: "vscode",
      vimMode: false,
      sync: false,
    };

    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    function applySelections(){
      // Theme
      $$("#themeCards .card").forEach(c => {
        c.classList.toggle("selected", c.dataset.theme === state.themePreset);
      });
      // Keymap
      $$("#keymapSeg .segbtn").forEach(b => {
        b.classList.toggle("selected", b.dataset.keymap === state.keymap);
      });
      // Switches
      const swV = $("#swVim");
      const swS = $("#swSync");
      swV.classList.toggle("on", state.vimMode);
      swS.classList.toggle("on", state.sync);
      swV.setAttribute("aria-checked", String(state.vimMode));
      swS.setAttribute("aria-checked", String(state.sync));
    }

    function goto(step){
      state.step = step;
      $("#screen-setup").classList.toggle("active", step === "setup");
      $("#screen-start").classList.toggle("active", step === "start");
      applySelections();
    }

    // Theme card clicks
    $("#themeCards").addEventListener("click", (e) => {
      const card = e.target.closest(".card");
      if(!card) return;
      state.themePreset = card.dataset.theme;
      applySelections();
    });

    // Keymap clicks
    $("#keymapSeg").addEventListener("click", (e) => {
      const btn = e.target.closest(".segbtn");
      if(!btn) return;
      state.keymap = btn.dataset.keymap;
      applySelections();
    });

    // Switches
    $("#swVim").addEventListener("click", () => { state.vimMode = !state.vimMode; applySelections(); });
    $("#swSync").addEventListener("click", () => { state.sync = !state.sync; applySelections(); });

    // Navigation
    $("#btnContinue").addEventListener("click", () => goto("start"));
    $("#pillAction").addEventListener("click", () => goto(state.step === "setup" ? "start" : "setup"));
    $("#btnBack").addEventListener("click", () => goto("setup"));
    $("#choiceBack").addEventListener("click", (e) => { if(e.target.tagName !== "BUTTON") goto("setup"); });
    $("#btnGetStarted").addEventListener("click", () => {
      // Replace with real action: open folder / quickstart / etc.
      alert("Get Started: wire this to your real entry action.");
    });
    $("#choiceStart").addEventListener("click", (e) => { if(e.target.tagName !== "BUTTON") $("#btnGetStarted").click(); });

    // Keyboard nicety
    window.addEventListener("keydown", (e) => {
      if((e.metaKey || e.ctrlKey) && e.key === "Enter") {
        goto(state.step === "setup" ? "start" : "setup");
      }
      if(e.key === "Escape" && state.step === "start") goto("setup");
    });

    applySelections();

    // ---- Animated dithering background (from dithering.html) ----
    (function initBackground(){
      const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
      if(reduceMotion) return;
      if(!window.THREE) return;

      const canvas = document.getElementById("bg");
      if(!canvas) return;

      const vertexShader = `
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `;

      const fragmentShader = `
        uniform float uTime;
        uniform vec2 uResolution;
        uniform vec2 uMouse;
        uniform vec3 uClickPos[10];
        uniform float uClickTimes[10];

        varying vec2 vUv;

        const float PIXEL_SIZE = 8.0;
        const int MAX_CLICKS = 10;

        float Bayer2(vec2 a) {
          a = floor(a);
          return fract(a.x / 2.0 + a.y * a.y * 0.75);
        }

        #define Bayer4(a)  (Bayer2(0.5 * (a)) * 0.25 + Bayer2(a))
        #define Bayer8(a)  (Bayer4(0.5 * (a)) * 0.25 + Bayer2(a))

        vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }
        vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }

        float snoise(vec3 v) {
          const vec2 C = vec2(1.0/6.0, 1.0/3.0);
          const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);

          vec3 i  = floor(v + dot(v, C.yyy));
          vec3 x0 = v - i + dot(i, C.xxx);

          vec3 g = step(x0.yzx, x0.xyz);
          vec3 l = 1.0 - g;
          vec3 i1 = min(g.xyz, l.zxy);
          vec3 i2 = max(g.xyz, l.zxy);

          vec3 x1 = x0 - i1 + C.xxx;
          vec3 x2 = x0 - i2 + C.yyy;
          vec3 x3 = x0 - D.yyy;

          i = mod289(i);
          vec4 p = permute(permute(permute(
            i.z + vec4(0.0, i1.z, i2.z, 1.0))
            + i.y + vec4(0.0, i1.y, i2.y, 1.0))
            + i.x + vec4(0.0, i1.x, i2.x, 1.0));

          float n_ = 0.142857142857;
          vec3 ns = n_ * D.wyz - D.xzx;

          vec4 j = p - 49.0 * floor(p * ns.z * ns.z);

          vec4 x_ = floor(j * ns.z);
          vec4 y_ = floor(j - 7.0 * x_);

          vec4 x = x_ *ns.x + ns.yyyy;
          vec4 y = y_ *ns.x + ns.yyyy;
          vec4 h = 1.0 - abs(x) - abs(y);

          vec4 b0 = vec4(x.xy, y.xy);
          vec4 b1 = vec4(x.zw, y.zw);

          vec4 s0 = floor(b0)*2.0 + 1.0;
          vec4 s1 = floor(b1)*2.0 + 1.0;
          vec4 sh = -step(h, vec4(0.0));

          vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy;
          vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww;

          vec3 p0 = vec3(a0.xy, h.x);
          vec3 p1 = vec3(a0.zw, h.y);
          vec3 p2 = vec3(a1.xy, h.z);
          vec3 p3 = vec3(a1.zw, h.w);

          vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2,p2), dot(p3,p3)));
          p0 *= norm.x;
          p1 *= norm.y;
          p2 *= norm.z;
          p3 *= norm.w;

          vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
          m = m * m;
          return 42.0 * dot(m*m, vec4(dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3)));
        }

        float fbm(vec3 p) {
          float value = 0.0;
          float amplitude = 0.5;
          float frequency = 1.0;
          for(int i = 0; i < 5; i++) {
            value += amplitude * snoise(p * frequency);
            frequency *= 2.0;
            amplitude *= 0.5;
          }
          return value;
        }

        void main() {
          vec2 uv = vUv;
          vec2 fragCoord = vUv * uResolution;
          float aspectRatio = uResolution.x / uResolution.y;

          vec3 noiseCoord = vec3(
            uv.x * aspectRatio * 2.0,
            uv.y * 2.0,
            uTime * 0.08
          );

          float noise = fbm(noiseCoord) * 0.5 + 0.5;

          float drift = sin(uv.x * 3.14159 + uTime * 0.15) * 0.5 + 0.5;
          drift *= cos(uv.y * 3.14159 * 0.7 + uTime * 0.12) * 0.5 + 0.5;

          float pattern = mix(noise, drift, 0.3);

          vec2 pixelId = floor(fragCoord / PIXEL_SIZE);
          float dither = Bayer8(pixelId);
          pattern += (dither - 0.5) * 0.3;

          float ripple = 0.0;
          for(int i = 0; i < MAX_CLICKS; i++) {
            vec3 click = uClickPos[i];
            if(click.x < 0.0) continue;

            vec2 clickUV = click.xy;
            float t = max(uTime - uClickTimes[i], 0.0);
            float r = distance(uv * vec2(aspectRatio, 1.0), clickUV * vec2(aspectRatio, 1.0));

            float waveR = 0.6 * t;
            float ring = exp(-pow((r - waveR) / 0.08, 2.0));
            float atten = exp(-2.0 * t) * exp(-1.5 * r);

            ripple = max(ripple, ring * atten);
          }

          pattern = clamp(pattern + ripple * 0.6, 0.0, 1.0);

          float mask = step(0.5, pattern);

          vec3 color1 = vec3(0.05, 0.08, 0.12);
          vec3 color2 = vec3(0.12, 0.18, 0.28);
          vec3 accent = vec3(0.20, 0.35, 0.55);

          float colorNoise = fbm(vec3(uv * 3.0, uTime * 0.05)) * 0.5 + 0.5;
          vec3 baseColor = mix(color1, color2, colorNoise);
          vec3 finalColor = mix(baseColor, accent, mask * 0.85);

          float vignette = 1.0 - length(uv - 0.5) * 0.6;
          finalColor *= vignette;

          gl_FragColor = vec4(finalColor, 1.0);
        }
      `;

      const scene = new THREE.Scene();
      const camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);

      const renderer = new THREE.WebGLRenderer({
        canvas,
        antialias: false,
        alpha: true,
        powerPreference: "high-performance",
      });
      renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));

      const clickPositions = new Array(10).fill(0).map(() => new THREE.Vector3(-1, -1, 0));
      const clickTimes = new Array(10).fill(0);
      let clickIndex = 0;

      const uniforms = {
        uTime: { value: 0 },
        uResolution: { value: new THREE.Vector2() },
        uMouse: { value: new THREE.Vector2(0.5, 0.5) },
        uClickPos: { value: clickPositions },
        uClickTimes: { value: clickTimes },
      };

      const geometry = new THREE.PlaneGeometry(2, 2);
      const material = new THREE.ShaderMaterial({ vertexShader, fragmentShader, uniforms });
      const mesh = new THREE.Mesh(geometry, material);
      scene.add(mesh);

      function resize(){
        const width = window.innerWidth;
        const height = window.innerHeight;
        renderer.setSize(width, height);
        uniforms.uResolution.value.set(width, height);
      }
      resize();
      window.addEventListener("resize", resize, { passive: true });

      // Mouse interaction (subtle, always on)
      window.addEventListener("mousemove", (e) => {
        const x = e.clientX / window.innerWidth;
        const y = 1.0 - (e.clientY / window.innerHeight);
        uniforms.uMouse.value.set(x, y);
      }, { passive: true });

      // Click ripples only when clicking outside the onboarding card
      window.addEventListener("click", (e) => {
        const app = document.getElementById("app");
        if(app && app.contains(e.target)) return;

        const x = e.clientX / window.innerWidth;
        const y = 1.0 - (e.clientY / window.innerHeight);
        clickPositions[clickIndex].set(x, y, 0);
        clickTimes[clickIndex] = uniforms.uTime.value;
        clickIndex = (clickIndex + 1) % 10;
      }, { passive: true });

      let raf = 0;
      const start = performance.now();
      function animate(now){
        raf = requestAnimationFrame(animate);
        uniforms.uTime.value = (now - start) / 1000;
        renderer.render(scene, camera);
      }
      raf = requestAnimationFrame(animate);
    })();
  </script>
</body>
</html>